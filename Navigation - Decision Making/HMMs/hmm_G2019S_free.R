library(HMM)

states <- c("Heading odor","Heading bottom","Opposite to odor","Heading top")

startProb = c(0.2340793916780997, 0.2081943228014398, 0.267553296511363, 0.2901729890090975)

HoProb <- c(0.8630750264939334, 0.052836472954560204, 0.012457555637260203, 0.07163094491424617)
HbProb <- c(0.05925979963038615, 0.8599358039101255, 0.06835424569594398, 0.012450150763544403)
OoProb <- c(0.011807447774750226, 0.05249016046018771, 0.8728617923100211, 0.06284059945504088)
HtProb <- c(0.05705113666102552, 0.009456182284488022, 0.05815028700036638, 0.8753423940541201)

transProb <- t(matrix(c(HoProb, HbProb, OoProb, HtProb),4))

elements <- c(225:360,0:224)

HoStateProb <- c(0.01364708, 0.01457707, 0.01327941, 0.01401475, 0.01254407,
                 0.0131929 , 0.01276034, 0.01278197, 0.01310639, 0.0134308 ,
                 0.01276034, 0.01276034, 0.0113978 , 0.01213314, 0.01237104,
                 0.01208988, 0.01198175, 0.01263058, 0.01327941, 0.01273872,
                 0.01286848, 0.01269546, 0.01256569, 0.01247918, 0.01161408,
                 0.01191686, 0.01120315, 0.01146268, 0.01206826, 0.01159245,
                 0.01252244, 0.01113827, 0.01215477, 0.01191686, 0.01256569,
                 0.01269546, 0.01312801, 0.01226291, 0.01295499, 0.01174384,
                 0.01180872, 0.01221965, 0.01092199, 0.01226291, 0.01183035,
                 0.01098687, 0.01094362, 0.01115989, 0.01079222, 0.01079222,
                 0.01141943, 0.01109501, 0.01085711, 0.01107338, 0.01027316,
                 0.01090036, 0.01087873, 0.00997037, 0.00977572, 0.0102299 ,
                 0.01072734, 0.01040292, 0.01018665, 0.01040292, 0.01012176,
                 0.0092134 , 0.00934317, 0.00865108, 0.00958107, 0.00968921,
                 0.00904038, 0.00942968, 0.00886736, 0.0092134 , 0.00888899,
                 0.0085862 , 0.0089755 , 0.00927828, 0.00923503, 0.00917015,
                 0.00852131, 0.00986223, 0.00888899, 0.00910526, 0.00893224,
                 0.00940805, 0.00929991, 0.00929991, 0.00793737, 0.00852131,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.      )
HbStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.00610349, 0.01074798, 0.01125863, 0.01086957, 0.01084525,
                 0.0109182 , 0.01043186, 0.01038323, 0.01157475, 0.01159907,
                 0.01086957, 0.01130727, 0.01082093, 0.01186655, 0.01196382,
                 0.01198813, 0.0123772 , 0.0122313 , 0.01069935, 0.01196382,
                 0.01249878, 0.01196382, 0.012669  , 0.01159907, 0.01269332,
                 0.01113705, 0.01249878, 0.01176928, 0.01169633, 0.01327692,
                 0.01242583, 0.01288785, 0.01240152, 0.01245015, 0.01308238,
                 0.01291217, 0.01286353, 0.01298512, 0.01286353, 0.01283922,
                 0.01240152, 0.01142885, 0.01220698, 0.01332555, 0.01259605,
                 0.00885128, 0.00982395, 0.00904581, 0.00926466, 0.01021301,
                 0.00909445, 0.00948351, 0.00967805, 0.01009143, 0.00996985,
                 0.00984826, 0.00965373, 0.00972668, 0.00967805, 0.01099115,
                 0.00950783, 0.01038323, 0.0098969 , 0.00941056, 0.00965373,
                 0.0100428 , 0.01079662, 0.01023733, 0.00984826, 0.01094252,
                 0.0113559 , 0.0113559 , 0.01057776, 0.01155043, 0.01116137,
                 0.0110641 , 0.01069935, 0.01084525, 0.01069935, 0.01072367,
                 0.0109182 , 0.01052913, 0.01113705, 0.0113559 , 0.01055345,
                 0.00999416, 0.00979963, 0.01031028, 0.01096683, 0.01147748,
                 0.00449859, 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.       )
OoStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.00999073, 0.01016102, 0.01044485, 0.00980151,
                 0.00980151, 0.01082329, 0.01078545, 0.01061515, 0.01029348,
                 0.0103124 , 0.01078545, 0.01012318, 0.01067191, 0.0104827 ,
                 0.01101251, 0.01101251, 0.01088005, 0.01061515, 0.01101251,
                 0.01108819, 0.0101421 , 0.01110712, 0.0115234 , 0.01210997,
                 0.01116388, 0.01131526, 0.01209105, 0.01165585, 0.01159908,
                 0.01159908, 0.01292361, 0.01148555, 0.01228027, 0.01220458,
                 0.0115234 , 0.01140987, 0.01175046, 0.0117883 , 0.01209105,
                 0.0121289 , 0.01140987, 0.01241272, 0.01188291, 0.01097466,
                 0.01188291, 0.01218566, 0.01089898, 0.01125849, 0.01214782,
                 0.01040701, 0.01184507, 0.01167477, 0.01158016, 0.01112604,
                 0.01243164, 0.01125849, 0.01188291, 0.01120173, 0.01214782,
                 0.01061515, 0.01137202, 0.0111828 , 0.0109179 , 0.01175046,
                 0.01186399, 0.01122065, 0.01165585, 0.01139094, 0.00983935,
                 0.01142879, 0.01106927, 0.01025563, 0.01114496, 0.00993396,
                 0.01086113, 0.01076652, 0.01072868, 0.01035024, 0.01029348,
                 0.00978259, 0.01133418, 0.0097069 , 0.01029348, 0.01025563,
                 0.01078545, 0.01125849, 0.00965014, 0.01159908, 0.01012318,
                 0.0113531 , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.         )
HtStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.00975278, 0.00994469, 0.01006682, 0.01038086,
                 0.01001448, 0.01029363, 0.01052044, 0.00966554, 0.0107298 ,
                 0.01050299, 0.01092172, 0.01093916, 0.0112881 , 0.01113108,
                 0.01060767, 0.01095661, 0.01100895, 0.0107298 , 0.01022384,
                 0.01078214, 0.01053789, 0.01066001, 0.01048555, 0.01062512,
                 0.01010172, 0.01134044, 0.0104332 , 0.01067746, 0.01069491,
                 0.0107298 , 0.01053789, 0.01085193, 0.0110264 , 0.0118115 ,
                 0.01160214, 0.01203831, 0.01086938, 0.01209065, 0.01132299,
                 0.0107298 , 0.01050299, 0.01125321, 0.01149746, 0.01095661,
                 0.01086938, 0.01151491, 0.01151491, 0.0109915 , 0.01182895,
                 0.01148001, 0.01142767, 0.01132299, 0.01059023, 0.01106129,
                 0.01196853, 0.01141023, 0.01148001, 0.01106129, 0.01139278,
                 0.01202087, 0.01139278, 0.01160214, 0.01191619, 0.01203831,
                 0.0118464 , 0.0118464 , 0.01174172, 0.0112881 , 0.01205576,
                 0.01202087, 0.01144512, 0.01134044, 0.01196853, 0.01149746,
                 0.01172427, 0.01165448, 0.01195108, 0.01163704, 0.01149746,
                 0.01100895, 0.01114852, 0.01135789, 0.01148001, 0.0107298 ,
                 0.0102064 , 0.01130555, 0.01088682, 0.01123576, 0.01097406,
                 0.01142767)

emissProb <- matrix(c(HoStateProb,HbStateProb,OoStateProb,HtStateProb), 4, byrow = T) 

hmm <- initHMM(States = states, 
               Symbols = elements,
               transProbs=transProb,
               emissionProbs = emissProb)

hmm$startProbs["Heading odor"] <- startProb[1]
hmm$startProbs["Heading bottom"] <- startProb[2]
hmm$startProbs["Opposite to odor"] <- startProb[3]
hmm$startProbs["Heading top"] <- startProb[4]

print(hmm)

simhmm <- simHMM(hmm, 1000000)
simhmm_df <- as.data.frame(simhmm)
write.table(simhmm,file = "simulacion_G2019S_free")

table(simhmm_df$states)

pie(table(simhmm_df$states),main = "Proportion of orientations LRRK2-G2019S free",
    col = c("lightgreen","lightblue","purple","lightyellow"),)

# Steady-state equations. [Ho Hb Oo Ht]*(I-transmat) = 0

I = diag(4)
matriz <- I- transProb
matriz <- t(matriz)
matriz <- rbind(matriz,c(1,1,1,1))
vector <- c(0,0,0,0,1)

round(qr.solve(matriz,vector)*100,digits = 2)

# Simulations

sim <- read.table("simulacion_G2019S_free")
states_count <- table(sim$states)
percentages <- round(prop.table(states_count)*100,digits = 2)
