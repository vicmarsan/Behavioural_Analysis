library(HMM)

states <- c("Heading odor","Heading bottom","Opposite to odor","Heading top")

startProb = c(0.30265959618940946, 0.23016970312162738, 0.2208882432897554, 0.2462824573992078)

HoProb <- c(0.8891887203407799, 0.051502476821957945, 0.00769067674100345, 0.051618126096258744)
HbProb <- c(0.06617665695095679, 0.8704600177417311, 0.054162970472690405, 0.009200354834621722)
OoProb <- c(0.00969258398478766, 0.05427318825269385, 0.8753169237270231, 0.06071730403549546)
HtProb <- c(0.06561493272692819, 0.009096077316657191, 0.05175762743983324, 0.8735313625165814)

transProb <- t(matrix(c(HoProb, HbProb, OoProb, HtProb),4))

elements <- c(225:360,0:224)

HoStateProb <- c(0.01056263, 0.01063973, 0.01062046, 0.0112758 , 0.01040843,
                 0.01094813, 0.01168058, 0.01031206, 0.01089031, 0.01121798,
                 0.01264432, 0.01171913, 0.01148783, 0.01233592, 0.01233592,
                 0.01198897, 0.01200825, 0.01218172, 0.01152638, 0.01295272,
                 0.0117384 , 0.01187333, 0.01241302, 0.01277924, 0.01239375,
                 0.01177695, 0.0125094 , 0.01223955, 0.01102523, 0.01164203,
                 0.01270215, 0.01137218, 0.01225882, 0.01225882, 0.0127407 ,
                 0.01285634, 0.01312619, 0.01289489, 0.0121239 , 0.01131435,
                 0.01200825, 0.01168058, 0.01169985, 0.0118926 , 0.01185405,
                 0.01112161, 0.01116015, 0.01146855, 0.01038916, 0.01117943,
                 0.01096741, 0.01006149, 0.01073611, 0.01141073, 0.00967599,
                 0.01075538, 0.01063973, 0.0115842 , 0.01100596, 0.01143   ,
                 0.01054336, 0.01042771, 0.01168058, 0.01098668, 0.01063973,
                 0.01085176, 0.01008076, 0.01063973, 0.00961816, 0.00979164,
                 0.01046626, 0.01010004, 0.01081321, 0.00983019, 0.00990729,
                 0.01083248, 0.00971454, 0.00948324, 0.01023496, 0.00921339,
                 0.00921339, 0.01063973, 0.01023496, 0.01033134, 0.00961816,
                 0.00967599, 0.00915557, 0.01004221, 0.00861587, 0.01011931,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        )
HbStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.00593081, 0.01138005, 0.01181092, 0.01193765, 0.01092384,
                 0.0114054 , 0.01249525, 0.010569  , 0.01132936, 0.01163351,
                 0.01064504, 0.0111266 , 0.01173489, 0.01115195, 0.01130402,
                 0.01143074, 0.01145609, 0.01094918, 0.01110125, 0.01110125,
                 0.01077177, 0.01082246, 0.01130402, 0.01132936, 0.01249525,
                 0.01117729, 0.01150678, 0.01178558, 0.01026486, 0.01107591,
                 0.010569  , 0.01188696, 0.01127867, 0.01097453, 0.01044228,
                 0.01105056, 0.01064504, 0.01059435, 0.01087315, 0.01049297,
                 0.01150678, 0.01135471, 0.01069573, 0.01039159, 0.01016348,
                 0.01064504, 0.0130275 , 0.01092384, 0.0124699 , 0.01216576,
                 0.01110125, 0.01208972, 0.01153213, 0.0111266 , 0.01138005,
                 0.01102522, 0.0111266 , 0.01044228, 0.01110125, 0.01099987,
                 0.0116842 , 0.01097453, 0.01016348, 0.01122798, 0.01046762,
                 0.01163351, 0.01125333, 0.01039159, 0.010569  , 0.00975795,
                 0.01039159, 0.01013813, 0.01069573, 0.01059435, 0.01087315,
                 0.01138005, 0.01135471, 0.01120264, 0.01110125, 0.01125333,
                 0.01110125, 0.01094918, 0.00958053, 0.01046762, 0.01054366,
                 0.01132936, 0.01145609, 0.01087315, 0.01087315, 0.011963  ,
                 0.00572804, 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.         )
OoStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.01064336, 0.01053771, 0.01183182, 0.01059053,
                 0.01096028, 0.01085464, 0.0120431 , 0.0123072 , 0.0125449 ,
                 0.01143566, 0.0112772 , 0.0125449 , 0.01233362, 0.0123072 ,
                 0.01201669, 0.01109233, 0.01140925, 0.01302028, 0.012809  ,
                 0.01185823, 0.01333721, 0.01220156, 0.01259772, 0.0110131 ,
                 0.0112772 , 0.01096028, 0.01214874, 0.01233362, 0.01167336,
                 0.01059053, 0.01236003, 0.01119797, 0.01133002, 0.01154131,
                 0.01164695, 0.01162054, 0.01059053, 0.01098669, 0.0115149 ,
                 0.01053771, 0.01162054, 0.010749  , 0.01199028, 0.01061694,
                 0.01117156, 0.01040566, 0.01061694, 0.01019438, 0.01061694,
                 0.01019438, 0.01027361, 0.01008874, 0.01098669, 0.01109233,
                 0.01080182, 0.01077541, 0.01085464, 0.00982464, 0.0105113 ,
                 0.01019438, 0.01148849, 0.01106592, 0.01130361, 0.01090746,
                 0.01130361, 0.0097454 , 0.01167336, 0.01059053, 0.01167336,
                 0.01148849, 0.00958694, 0.0105113 , 0.01193746, 0.01090746,
                 0.01056412, 0.01111874, 0.01098669, 0.01045848, 0.01096028,
                 0.00966617, 0.01003592, 0.01080182, 0.01037925, 0.01064336,
                 0.00969258, 0.01093387, 0.00953412, 0.00977181, 0.00979823,
                 0.0110131 , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        )
HtStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.00802994, 0.00923798, 0.00949854, 0.00952223,
                 0.00935642, 0.00959329, 0.00987754, 0.00897743, 0.00973541,
                 0.00926167, 0.00940379, 0.00940379, 0.01018547, 0.0099486 ,
                 0.00990122, 0.0101381 , 0.00893005, 0.00954592, 0.00980648,
                 0.00992491, 0.01075396, 0.00968804, 0.01035128, 0.01082502,
                 0.01063553, 0.00980648, 0.00990122, 0.01037497, 0.0112277 ,
                 0.01042234, 0.01075396, 0.01020916, 0.01006703, 0.0112277 ,
                 0.01103821, 0.01118033, 0.01070659, 0.0104934 , 0.01210413,
                 0.0116067 , 0.01125139, 0.01163039, 0.01129877, 0.01075396,
                 0.01011441, 0.01146458, 0.0108724 , 0.01039865, 0.01158301,
                 0.01075396, 0.01146458, 0.01198569, 0.01151195, 0.0108724 ,
                 0.01129877, 0.01139351, 0.01115664, 0.01106189, 0.01264893,
                 0.01238837, 0.0108724 , 0.01080134, 0.01132245, 0.01245944,
                 0.01108558, 0.01151195, 0.01136983, 0.01165407, 0.01198569,
                 0.01139351, 0.01243575, 0.01286212, 0.01229363, 0.01205675,
                 0.0125305 , 0.01264893, 0.01298055, 0.01328849, 0.01186726,
                 0.01222256, 0.01269631, 0.01226994, 0.0128858 , 0.01423597,
                 0.01238837, 0.01241206, 0.01321742, 0.01402279, 0.012341  ,
                 0.01433072)

emissProb <- matrix(c(HoStateProb,HbStateProb,OoStateProb,HtStateProb), 4, byrow = T) 

hmm <- initHMM(States = states, 
               Symbols = elements,
               transProbs=transProb,
               emissionProbs = emissProb)

hmm$startProbs["Heading odor"] <- startProb[1]
hmm$startProbs["Heading bottom"] <- startProb[2]
hmm$startProbs["Opposite to odor"] <- startProb[3]
hmm$startProbs["Heading top"] <- startProb[4]

print(hmm)

simhmm <- simHMM(hmm, 1000000)
simhmm_df <- as.data.frame(simhmm)
write.table(simhmm,file = "simulacion_asyn_odor")

table(simhmm_df$states)

pie(table(simhmm_df$states),main = "Proportion of orientations aSyn-A53T odor",
    col = c("lightgreen","lightblue","purple","lightyellow"),)


# Steady-state equations. [Ho Hb Oo Ht]*(I-transmat) = 0

I = diag(4)
matriz <- I- transProb
matriz <- t(matriz)
matriz <- rbind(matriz,c(1,1,1,1))
vector <- c(0,0,0,0,1)

round(qr.solve(matriz,vector)*100,digits = 2)

# Simulations

sim <- read.table("simulacion_asyn_odor")
states_count <- table(sim$states)
percentages <- round(prop.table(states_count)*100,digits = 2)
