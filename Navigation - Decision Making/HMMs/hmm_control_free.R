library(HMM)

states <- c("Heading odor","Heading bottom","Opposite to odor","Heading top")

startProb = c(0.2437050476532764, 0.20738809815579007, 0.2714569648262095, 0.27744988936472403)

HoProb <- c(0.8938007498089942, 0.044366660151738596, 0.007658001812334536, 0.05417458822693271)
HbProb <- c(0.05196893139015325, 0.8822190671065269, 0.05541403933686892, 0.010397962166450912)
OoProb <- c(0.0074493539639495935, 0.04169724038921678, 0.8978146434838092, 0.0530387621630244)
HtProb <- c(0.04714934527804223, 0.008271814961060041, 0.05183150468996301, 0.8927473350709347)

transProb <- t(matrix(c(HoProb, HbProb, OoProb, HtProb),4))

elements <- c(225:360,0:224)

HoStateProb <- c(0.01289956, 0.01364581, 0.0125975 , 0.01297063, 0.01227768,
                 0.01314831, 0.01270411, 0.01224214, 0.01241982, 0.01222437,
                 0.01265081, 0.01293509, 0.01220661, 0.01192232, 0.01273965,
                 0.01241982, 0.01295286, 0.01240205, 0.01320161, 0.01279295,
                 0.01302393, 0.01375242, 0.01382349, 0.01355697, 0.01325492,
                 0.0129884 , 0.01282849, 0.0130417 , 0.01218884, 0.01249089,
                 0.01289956, 0.01279295, 0.01309501, 0.0125975 , 0.01202893,
                 0.01307724, 0.01241982, 0.01066079, 0.01178017, 0.01252643,
                 0.01195785, 0.01114053, 0.01117606, 0.0117091 , 0.01103392,
                 0.01073186, 0.01078517, 0.01183348, 0.01064302, 0.01048311,
                 0.01053642, 0.01147812, 0.01007445, 0.00973686, 0.01073186,
                 0.01018106, 0.00984346, 0.01000338, 0.00963025, 0.0099323 ,
                 0.01042981, 0.01000338, 0.01025213, 0.01000338, 0.00913274,
                 0.00966578, 0.01007445, 0.00964802, 0.00959471, 0.00954141,
                 0.00980793, 0.00927489, 0.00879515, 0.00907944, 0.01051865,
                 0.00863524, 0.0081022 , 0.00897283, 0.00920382, 0.0090439 ,
                 0.00888399, 0.00884846, 0.00957694, 0.00902614, 0.00931042,
                 0.00829765, 0.0085464 , 0.00874185, 0.00838649, 0.00877738,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        )
HbStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.00634735, 0.01167161, 0.01066939, 0.01150457, 0.01123314,
                 0.01244415, 0.01125402, 0.01140018, 0.01263206, 0.01252767,
                 0.01248591, 0.01204744, 0.01173425, 0.01202656, 0.01215184,
                 0.01284086, 0.0118804 , 0.01252767, 0.01217271, 0.01177601,
                 0.01231887, 0.01206832, 0.01236063, 0.01185952, 0.01104522,
                 0.01160897, 0.01125402, 0.01229799, 0.01144193, 0.01175513,
                 0.01194304, 0.0126947 , 0.01217271, 0.01200568, 0.01317493,
                 0.01221447, 0.01288262, 0.01252767, 0.0118804 , 0.01284086,
                 0.01273646, 0.01284086, 0.01250679, 0.01169249, 0.01277822,
                 0.00945839, 0.01016829, 0.00995949, 0.00954191, 0.00998037,
                 0.01048148, 0.00989686, 0.00931223, 0.00912432, 0.01000125,
                 0.00960454, 0.00870673, 0.01021005, 0.00987598, 0.00952103,
                 0.00977158, 0.0097507 , 0.00983422, 0.00937487, 0.00966718,
                 0.00931223, 0.00933311, 0.00947927, 0.01060676, 0.01025181,
                 0.00995949, 0.00968806, 0.00983422, 0.01131666, 0.00972982,
                 0.00952103, 0.01081555, 0.00987598, 0.01018917, 0.01075291,
                 0.00993861, 0.01083643, 0.01050236, 0.01048148, 0.01077379,
                 0.01148369, 0.01096171, 0.01185952, 0.0119848 , 0.01242327,
                 0.00561657, 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        )
OoStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.01038443, 0.01036848, 0.00936353, 0.00990589,
                 0.01103844, 0.01044824, 0.00988993, 0.01030467, 0.01086298,
                 0.01067156, 0.01038443, 0.01017706, 0.0111182 , 0.01100654,
                 0.01073536, 0.01087893, 0.01025682, 0.01174031, 0.01137342,
                 0.01142128, 0.01113415, 0.01169245, 0.01063966, 0.01116606,
                 0.0122029 , 0.01146913, 0.01199553, 0.01124581, 0.01202744,
                 0.01175626, 0.01169245, 0.01188387, 0.01180412, 0.01103844,
                 0.01142128, 0.01175626, 0.01186792, 0.01151699, 0.01191578,
                 0.01148509, 0.01255384, 0.01215505, 0.0122029 , 0.01279311,
                 0.0126974 , 0.01255384, 0.01135747, 0.01261764, 0.01236242,
                 0.0110863 , 0.01166055, 0.01174031, 0.01070346, 0.01073536,
                 0.00961876, 0.01075132, 0.01016111, 0.01078322, 0.01038443,
                 0.01048014, 0.01129367, 0.01089488, 0.01036848, 0.0100654 ,
                 0.0111182 , 0.01118201, 0.01134152, 0.01118201, 0.01134152,
                 0.01107035, 0.01063966, 0.0110863 , 0.01121391, 0.0116765 ,
                 0.01102249, 0.01086298, 0.01129367, 0.01068751, 0.01116606,
                 0.01087893, 0.0106237 , 0.01079917, 0.01041633, 0.01126176,
                 0.01044824, 0.01020896, 0.01071941, 0.01070346, 0.00982613,
                 0.01116606, 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.         )
HtStateProb <- c(0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.        , 0.        , 0.        , 0.        ,
                 0.        , 0.00913007, 0.00989481, 0.01034741, 0.00961388,
                 0.01045666, 0.01034741, 0.01036302, 0.0103318 , 0.01056591,
                 0.00959828, 0.0103318 , 0.01023816, 0.00984799, 0.0096451 ,
                 0.00970753, 0.00983238, 0.00972313, 0.00956706, 0.0091925 ,
                 0.01034741, 0.01025377, 0.01026938, 0.01044105, 0.01084683,
                 0.01050348, 0.00955146, 0.01006649, 0.01040984, 0.01042545,
                 0.01030059, 0.00992602, 0.01117458, 0.01028498, 0.01040984,
                 0.01078441, 0.01184568, 0.01064394, 0.0100977 , 0.01073758,
                 0.01153354, 0.01161157, 0.01129944, 0.01125261, 0.01048787,
                 0.01173643, 0.01147111, 0.0103318 , 0.01168961, 0.01150233,
                 0.01173643, 0.0112214 , 0.0114555 , 0.01154915, 0.01142429,
                 0.01192371, 0.01207978, 0.01148672, 0.01170522, 0.01217342,
                 0.01148672, 0.01117458, 0.01123701, 0.01162718, 0.01200175,
                 0.01218903, 0.01284452, 0.0134688 , 0.01276649, 0.01237631,
                 0.01229828, 0.01223585, 0.01240753, 0.01242314, 0.01318788,
                 0.01198614, 0.01133065, 0.01228267, 0.01125261, 0.01154915,
                 0.01232949, 0.01217342, 0.01154915, 0.01153354, 0.01117458,
                 0.01168961, 0.01225146, 0.01164279, 0.01197053, 0.01217342,
                 0.01165839)

emissProb <- matrix(c(HoStateProb,HbStateProb,OoStateProb,HtStateProb), 4, byrow = T) 

hmm <- initHMM(States = states, 
               Symbols = elements,
               transProbs=transProb,
               emissionProbs = emissProb)

hmm$startProbs["Heading odor"] <- startProb[1]
hmm$startProbs["Heading bottom"] <- startProb[2]
hmm$startProbs["Opposite to odor"] <- startProb[3]
hmm$startProbs["Heading top"] <- startProb[4]

print(hmm)

simhmm <- simHMM(hmm, 1000000)
simhmm_df <- as.data.frame(simhmm)
write.table(simhmm,file = "simulacion_control_free",row.names = F)

table(simhmm_df$states)

pie(table(simhmm_df$states),main = "Proportion of orientations emptyUAS-free",
    col = c("lightgreen","lightblue","purple","lightyellow"),)

# Steady-state equations. [Ho Hb Oo Ht]*(I-transmat) = 0

I = diag(4)
matriz <- I- transProb
matriz <- t(matriz)
matriz <- rbind(matriz,c(1,1,1,1))
vector <- c(0,0,0,0,1)

round(qr.solve(matriz,vector)*100,digits = 2)

# Simulations

sim <- read.table("simulacion_control_free")
states_count <- table(sim$V1)
percentages <- round(prop.table(states_count)*100,digits = 2)

